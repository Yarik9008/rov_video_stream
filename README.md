# ROV Video Stream

Система для трансляции видео по сети с помощью GStreamer. Включает серверный и клиентский скрипты для захвата, передачи и воспроизведения видео в реальном времени.

## Требования

- Python 3.6+
- GStreamer 1.0 или выше
  - **Windows**: Скачайте с [официального сайта](https://gstreamer.freedesktop.org/download/)
    - После установки скрипт автоматически найдет GStreamer в стандартных местах
  - **Linux**: 
    - Ubuntu/Debian: `sudo apt-get install gstreamer1.0-tools gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav`
    - Fedora: `sudo dnf install gstreamer1 gstreamer1-plugins-base gstreamer1-plugins-good gstreamer1-plugins-bad gstreamer1-plugins-ugly`
  - **macOS**: `brew install gstreamer gst-plugins-base gst-plugins-good gst-plugins-bad gst-plugins-ugly gst-libav`

## Установка

1. Убедитесь, что GStreamer установлен и доступен в PATH:
   ```bash
   gst-launch-1.0 --version
   ```

2. Скрипты не требуют дополнительных Python-зависимостей (используют только стандартную библиотеку).

## Использование

### Сервер (трансляция видео)

#### Трансляция с веб-камеры:
```bash
python server.py
```

#### Трансляция из видео файла:
```bash
python server.py --source file --file путь/к/видео.mp4
```

#### Параметры сервера:
- `--source`: Источник видео (`webcam` или `file`, по умолчанию: `webcam`)
- `--file`: Путь к видео файлу (если `source=file`)
- `--host`: IP адрес для отправки (по умолчанию: `127.0.0.1`)
- `--port`: Порт для видео (по умолчанию: `5004`)
- `--width`: Ширина видео (по умолчанию: `640`)
- `--height`: Высота видео (по умолчанию: `480`)
- `--fps`: Частота кадров (по умолчанию: `30`)
- `--device`: Индекс видеоустройства (по умолчанию: `0`) - для выбора конкретной веб-камеры

#### Примеры:
```bash
# Трансляция с веб-камеры на другой компьютер
python server.py --host 192.168.1.100 --width 1280 --height 720

# Трансляция видео файла
python server.py --source file --file video.mp4 --width 1920 --height 1080 --fps 25

# Использование второй веб-камеры (Windows/macOS)
python server.py --device 1

# Трансляция с веб-камеры в высоком разрешении
python server.py --width 1920 --height 1080 --fps 30
```

### Клиент (воспроизведение)

#### Подключение к серверу:
```bash
python client.py
```

#### Параметры клиента:
- `--host`: IP адрес сервера (по умолчанию: `127.0.0.1`, используйте `auto` для автообнаружения)
- `--port`: Порт для видео (по умолчанию: `5004`)
- `--auto`: Автоматически найти сервер в локальной сети

#### Примеры:
```bash
# Автоматический поиск сервера в локальной сети
python client.py --auto
# или
python client.py --host auto

# Подключение к локальному серверу
python client.py

# Подключение к удаленному серверу
python client.py --host 192.168.1.100 --port 5004
```

## Пример работы

### Простой способ (автообнаружение):

1. **Запустите сервер** на компьютере с веб-камерой:
   ```bash
   python server.py --host 0.0.0.0
   ```
   Сервер автоматически начнет отправлять broadcast сообщения для обнаружения.

2. **Запустите клиент** на любом компьютере в той же сети:
   ```bash
   python client.py --auto
   ```
   Клиент автоматически найдет сервер и подключится к нему.

3. Видео должно появиться в окне клиента.

4. Для остановки нажмите `Ctrl+C` на сервере или клиенте.

### Ручной способ:

1. **Запустите сервер** (на компьютере с веб-камерой или видео файлом):
   ```bash
   python server.py
   ```

2. **Запустите клиент** (на том же или другом компьютере):
   ```bash
   python client.py
   ```

3. Видео должно появиться в окне клиента.

4. Для остановки нажмите `Ctrl+C` на сервере или клиенте.

## Сетевая трансляция

Для трансляции между разными компьютерами:

1. Узнайте IP адрес сервера:
   - **Windows**: `ipconfig`
   - **Linux/macOS**: `ifconfig` или `ip addr`

2. Запустите сервер с указанием IP адреса:
   ```bash
   python server.py --host <IP_АДРЕС_СЕРВЕРА>
   ```

3. Запустите клиент с указанием IP адреса сервера:
   ```bash
   python client.py --host <IP_АДРЕС_СЕРВЕРА>
   ```

4. Убедитесь, что порт 5004 (или указанный вами) открыт в файрволе.

## Технические детали

- **Протокол**: RTP over UDP
- **Кодек**: H.264 (x264)
- **Формат**: Raw video → H.264 → RTP → UDP
- **Поддерживаемые платформы**: Windows, Linux, macOS
- **Автообнаружение**: UDP broadcast на порту 5003
- **Источники видео**:
  - Windows: `mfvideosrc` (Media Foundation)
  - Linux: `v4l2src` (Video4Linux2)
  - macOS: `avfvideosrc` (AVFoundation)

## Устранение неполадок

### GStreamer не найден
- Убедитесь, что GStreamer установлен и добавлен в PATH
- На Windows добавьте путь к GStreamer в переменную окружения PATH

### Веб-камера не работает
- **Windows**: Убедитесь, что используется правильный `device-index` (попробуйте 0, 1, 2...). Используйте параметр `--device` для выбора устройства
- **Linux**: Проверьте доступность `/dev/video0` или используйте `v4l2-ctl --list-devices` для списка устройств. Используйте `--device` для выбора другого устройства (например, `--device 1` для `/dev/video1`)
- **macOS**: Используйте параметр `--device` для выбора другой камеры (0, 1, 2...)

### Видео не воспроизводится
- Проверьте, что сервер запущен и транслирует
- Убедитесь, что порты не заблокированы файрволом
- Проверьте, что IP адреса указаны правильно

### Низкое качество или задержки
- Уменьшите разрешение: `--width 640 --height 480`
- Уменьшите FPS: `--fps 15`
- Увеличьте битрейт в коде (измените `bitrate=500` на большее значение)

## Лицензия

Свободное использование для любых целей.
