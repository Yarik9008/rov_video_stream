# ROV Video Stream (WebRTC)

Минимальный проект для **низколатентной** трансляции видео по **WebRTC** в локальной сети:

- **Сервер**: захват камеры/файла через OpenCV → WebRTC
- **Клиент**: автообнаружение сервера по UDP broadcast → WebRTC → окно OpenCV

## Требования

- Python 3.9+ (рекомендуется 3.10+)
- Зависимости:

```bash
pip install -r requirements.txt
```

## Запуск

### Сервер (LAN, авто‑IP, broadcast discovery)

```bash
python3 server.py --host 0.0.0.0 --signal-port 8080
```

### Режим максимального качества

Для максимального качества используйте режим `--max-quality` (автоматический расчет битрейта):

```bash
python3 server.py --host 0.0.0.0 --max-quality --fps 60
```

Или вручную настройте параметры:

```bash
# Высокое качество (1080p, 30 FPS, 20 Mbps)
python3 server.py --host 0.0.0.0 --width 1920 --height 1080 --fps 30 --bitrate 20000

# Максимальное качество (4K, 60 FPS, 200 Mbps)
python3 server.py --host 0.0.0.0 --width 3840 --height 2160 --fps 60 --bitrate 200000
```

**Важно**: 
- По умолчанию сервер пытается отдавать **4K (3840x2160)**. Если нужно нативное разрешение источника — используйте `--width 0 --height 0`
- Битрейт по умолчанию: 200 Mbps (200000 kbps)
- В режиме `--max-quality` битрейт рассчитывается автоматически на основе разрешения и FPS

По умолчанию сервер шлёт broadcast на UDP порт `5003`, и клиент может найти его автоматически.

### Клиент (автообнаружение)

```bash
python3 client.py --auto
```

### Клиент (вручную)

```bash
python3 client.py --host <IP_СЕРВЕРА> --signal-port 8080
```

## Параметры

### server.py
- **--source**: `webcam` (по умолчанию) или `file`
- **--file**: путь к файлу (для `--source file`)
- **--device**: индекс камеры (по умолчанию `0`)
- **--width/--height**: разрешение кадра (по умолчанию `3840x2160` = 4K; `0` = исходное разрешение)
- **--fps**: частота кадров (по умолчанию `30`, рекомендуется `30-60` для максимального качества)
- **--bitrate**: битрейт в kbps (по умолчанию `200000` = 200 Mbps для максимального качества)
- **--max-quality**: режим максимального качества (автоматический расчет битрейта, без ресайза)
- **--signal-port**: порт HTTP signaling (по умолчанию `8080`)
- **--stun**: включить публичный STUN (для LAN обычно не нужно)

### client.py
- **--host**: IP сервера или `auto`
- **--auto**: автообнаружение по broadcast
- **--signal-port**: порт HTTP signaling (по умолчанию `8080`)
- **--stun**: включить публичный STUN (для LAN обычно не нужно)

## Управление

- Закрыть клиент: **Q** или **ESC** в окне видео
- Остановить сервер: **Ctrl+C**
