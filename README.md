# ROV Video Stream (WebRTC)

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è **–Ω–∏–∑–∫–æ–ª–∞—Ç–µ–Ω—Ç–Ω–æ–π** —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –≤–∏–¥–µ–æ –ø–æ **WebRTC** –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏:

- **–°–µ—Ä–≤–µ—Ä**: –∑–∞—Ö–≤–∞—Ç –∫–∞–º–µ—Ä—ã/—Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ OpenCV ‚Üí WebRTC
- **–ö–ª–∏–µ–Ω—Ç**: –∞–≤—Ç–æ–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ UDP broadcast ‚Üí WebRTC ‚Üí –æ–∫–Ω–æ OpenCV

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3.10+)
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

## –ó–∞–ø—É—Å–∫

### –°–µ—Ä–≤–µ—Ä (LAN, –∞–≤—Ç–æ‚ÄëIP, broadcast discovery)

```bash
python3 server.py --host 0.0.0.0 --signal-port 8080
```

## GPU WebRTC (GStreamer, NVIDIA NVENC/NVDEC)

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ **–∞–ø–ø–∞—Ä–∞—Ç–Ω–∞—è** –∫–æ–¥–∏—Ä–æ–≤–∫–∞/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–µ (NVIDIA):
- **—Å–µ—Ä–≤–µ—Ä**: `NVENC` (`nvh264enc`)
- **–∫–ª–∏–µ–Ω—Ç**: `NVDEC` (`nvh264dec`)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è (Windows)

–£ –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **GStreamer MSVC x86_64** (–∫–∞–∫ –º–∏–Ω–∏–º—É–º –ø–ª–∞–≥–∏–Ω—ã `webrtcbin` –∏ `nvcodec`):

- `gst-inspect-1.0 webrtcbin`
- `gst-inspect-1.0 nvh264enc`
- `gst-inspect-1.0 nvh264dec`

–¢–∞–∫–∂–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è `webrtcbin` –∏–∑ Python –Ω—É–∂–µ–Ω GI typelib:

- `GstWebRTC-1.0.typelib` (namespace `GstWebRTC`)

–û–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤:

`C:\Program Files\GStreamer\1.0\msvc_x86_64\lib\girepository-1.0`

–ï—Å–ª–∏ `GstWebRTC-1.0.typelib` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, `server_gst.py/client_gst.py` –Ω–µ —Å–º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å offer/answer/ICE.

–ü—Ä–æ–≤–µ—Ä–∫–∞ (–¥–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ `OK`):

```bash
python -c "import sys; sys.path.insert(0, r'C:\Program Files\GStreamer\1.0\msvc_x86_64\lib\site-packages'); import gi; gi.require_version('GstWebRTC','1.0'); from gi.repository import GstWebRTC; print('OK')"
```

–ï—Å–ª–∏ –ø–∞–¥–∞–µ—Ç `Namespace GstWebRTC not available`, –∑–Ω–∞—á–∏—Ç –≤ –≤–∞—à–µ–π —Å–±–æ—Ä–∫–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã typelibs WebRTC.
–û–±—ã—á–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∞ *Development* –ø–∞–∫–µ—Ç–æ–≤ GStreamer, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è `-bad` (WebRTC –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ `gst-plugins-bad`).

–í–∞–∂–Ω–æ: –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–µ GStreamer Python bindings (`gi`) –ª–µ–∂–∞—Ç –≤–Ω—É—Ç—Ä–∏:

`C:\Program Files\GStreamer\1.0\msvc_x86_64\lib\site-packages`

–°–∫—Ä–∏–ø—Ç—ã `server_gst.py` / `client_gst.py` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç** —ç—Ç–æ—Ç –ø—É—Ç—å –≤ `sys.path`
–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç `GI_TYPELIB_PATH`/DLL paths.

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—É—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äî –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

`GSTREAMER_1_0_ROOT_MSVC_X86_64`

### –ó–∞–ø—É—Å–∫ GPU —Å–µ—Ä–≤–µ—Ä–∞

```bash
python3 server_gst.py --host 0.0.0.0 --transport rtp --width 3840 --height 2160 --fps 60 --bitrate 250000
```

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- `--bitrate` –∑–∞–¥–∞—ë—Ç—Å—è –≤ **kbit/sec** (–Ω–∞–ø—Ä–∏–º–µ—Ä 250000 = 250 Mbps)
- –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å `--webrtc-latency 0`

### –ó–∞–ø—É—Å–∫ GPU –∫–ª–∏–µ–Ω—Ç–∞ (auto-discovery)

```bash
python3 client_gst.py --auto
```

### –ü–æ—á–µ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é RTP, –∞ –Ω–µ WebRTC

–ù–∞ Windows –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–±–æ—Ä–∫–∞—Ö GStreamer –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `GstWebRTC-1.0.typelib`, –∏ —Ç–æ–≥–¥–∞ Python –Ω–µ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å negotiation —á–µ—Ä–µ–∑ `webrtcbin`.
–ü–æ—ç—Ç–æ–º—É `server_gst.py` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **RTP/UDP**, –∫–æ—Ç–æ—Ä—ã–π:
- –Ω–µ —Ç—Ä–µ–±—É–µ—Ç `GstWebRTC` typelibs
- –≤—Å—ë —Ä–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **NVENC/NVDEC**
- –¥–∞—ë—Ç –æ—á–µ–Ω—å –Ω–∏–∑–∫—É—é –∑–∞–¥–µ—Ä–∂–∫—É –≤ LAN

RTP –ø–æ—Ç–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–¥—ë—Ç –≤ multicast `udp://239.255.0.1:5004`.
–ï—Å–ª–∏ multicast –≤ —Å–µ—Ç–∏ –∑–∞–ø—Ä–µ—â—ë–Ω ‚Äî —É–∫–∞–∂–∏—Ç–µ `--rtp-host <IP_–∫–ª–∏–µ–Ω—Ç–∞>` –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ UDP –ø–æ—Ä—Ç `5004` –≤ firewall.

### –†–µ–∂–∏–º file passthrough (–º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–æ/–º–∏–Ω. –∑–∞–¥–µ—Ä–∂–∫–∞, –Ω–æ –±–µ–∑ NVENC)

–ï—Å–ª–∏ —Ñ–∞–π–ª —É–∂–µ H.264 (–Ω–∞–ø—Ä–∏–º–µ—Ä `mp4`), –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –µ–≥–æ **–±–µ–∑ –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è**
(—ç—Ç–æ –¥–∞—ë—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É, –Ω–æ NVENC –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):

```bash
python3 server_gst.py --source file --file video/test.mp4 --file-passthrough --host 0.0.0.0
```

### –†–µ–∂–∏–º –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ –í–ö–õ–Æ–ß–ï–ù** –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–µ–∑ –ª–∞–≥–æ–≤:

```bash
python3 server.py --host 0.0.0.0
```

–ò–ª–∏ —è–≤–Ω–æ:

```bash
python3 server.py --host 0.0.0.0 --low-latency
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: 1080p (1920x1080)
- FPS: 30
- –ë–∏—Ç—Ä–µ–π—Ç: ~9-10 Mbps (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –ó–∞–¥–µ—Ä–∂–∫–∞: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è

### –†–µ–∂–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (—Å –±–æ–ª—å—à–µ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π):

```bash
python3 server.py --host 0.0.0.0 --max-quality --no-low-latency --fps 60
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```bash
# –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ + –Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (1080p, 30 FPS, 15 Mbps)
python3 server.py --host 0.0.0.0 --width 1920 --height 1080 --fps 30 --bitrate 15000

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (4K, 60 FPS, –∞–≤—Ç–æ–±–∏—Ç—Ä–µ–π—Ç ~250 Mbps)
python3 server.py --host 0.0.0.0 --max-quality --no-low-latency --width 3840 --height 2160 --fps 60
```

**–í–∞–∂–Ω–æ**: 
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **1080p** —Å —Ä–µ–∂–∏–º–æ–º –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
- –î–ª—è 4K –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--width 3840 --height 2160`
- –î–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞: `--width 0 --height 0`
- –í —Ä–µ–∂–∏–º–∞—Ö `--max-quality` –∏ `--low-latency` –±–∏—Ç—Ä–µ–π—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

üìñ **–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:** —Å–º. [LOW_LATENCY_GUIDE.md](LOW_LATENCY_GUIDE.md)

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä —à–ª—ë—Ç broadcast –Ω–∞ UDP –ø–æ—Ä—Ç `5003`, –∏ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –ö–ª–∏–µ–Ω—Ç (–∞–≤—Ç–æ–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ)

```bash
python3 client.py --auto
```

### –ö–ª–∏–µ–Ω—Ç (–≤—Ä—É—á–Ω—É—é)

```bash
python3 client.py --host <IP_–°–ï–†–í–ï–†–ê> --signal-port 8080
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

### server.py
- **--source**: `webcam` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ `file`
- **--file**: –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É (–¥–ª—è `--source file`)
- **--device**: –∏–Ω–¥–µ–∫—Å –∫–∞–º–µ—Ä—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0`)
- **--width/--height**: —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–∞–¥—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `1920x1080` = 1080p; `0` = –∏—Å—Ö–æ–¥–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ)
- **--fps**: —á–∞—Å—Ç–æ—Ç–∞ –∫–∞–¥—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `30`)
- **--bitrate**: –±–∏—Ç—Ä–µ–π—Ç –≤ kbps (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `10000` = 10 Mbps)
- **--low-latency**: —Ä–µ–∂–∏–º –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –í–ö–õ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--no-low-latency` –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è)
- **--max-quality**: —Ä–µ–∂–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –í–´–ö–õ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –±–∏—Ç—Ä–µ–π—Ç–∞)
- **--signal-port**: –ø–æ—Ä—Ç HTTP signaling (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `8080`)
- **--stun**: –≤–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π STUN (–¥–ª—è LAN –æ–±—ã—á–Ω–æ –Ω–µ –Ω—É–∂–Ω–æ)

### client.py
- **--host**: IP —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ `auto`
- **--auto**: –∞–≤—Ç–æ–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ broadcast
- **--signal-port**: –ø–æ—Ä—Ç HTTP signaling (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `8080`)
- **--stun**: –≤–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π STUN (–¥–ª—è LAN –æ–±—ã—á–Ω–æ –Ω–µ –Ω—É–∂–Ω–æ)

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

- –ó–∞–∫—Ä—ã—Ç—å –∫–ª–∏–µ–Ω—Ç: **Q** –∏–ª–∏ **ESC** –≤ –æ–∫–Ω–µ –≤–∏–¥–µ–æ
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä: **Ctrl+C**
